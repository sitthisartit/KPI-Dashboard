<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Infographic: KPI แผนกคลังสินค้า</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- เพิ่ม Chart.js Datalabels Plugin -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;600;700&display=swap" rel="stylesheet">

    <!-- Chosen Palette: Warm Neutrals (Background image, White/translucent cards, Blue/Teal/Rose accents) -->
    <!-- Application Structure Plan: The application is structured as a Single Page Application (SPA) with distinct sections for "KPI & ความเสี่ยง", "แนวโน้มรวม", "ข้อสอบ", and "แบบฟอร์มเอกสาร". Navigation is handled via buttons in a central `nav` element, dynamically showing/hiding sections. The "KPI & ความเสี่ยง" section features interactive KPI cards with sparklines and detailed modals, allowing users to explore monthly performance and methodological details. The "แนวโน้มรวม" section provides a comprehensive view of all KPI trends, with "ข้อผิดพลาดในกระบวนการทำงาน" separated for focused analysis. The "ข้อสอบ" and "แบบฟอร์มเอกสาร" sections offer access to external resources like Google Forms and Google Sheets. This structure was chosen to provide a clear, thematic separation of content, making it easy for users to navigate between different aspects of warehouse management information (performance, risks, training, documentation) without reloading the page. The interactive elements like month selection, detail modals, and separate trend charts enhance user understanding and exploration by allowing drill-downs and focused analysis. -->
    <!-- Visualization & Content Choices:
        - KPI Cards (KPI & ความเสี่ยง section): Goal: Inform, Compare. Viz: Gauge Chart (Chart.js Doughnut) for percentage KPIs, large color-coded number for count KPIs. Sparkline (Chart.js Line) for monthly trends on each card. Interaction: Month selection dropdown to change displayed data, "ดูรายละเอียด" button to open a modal with full KPI methodology and a detailed line chart of monthly trends. Justification: Gauge charts provide an immediate visual of performance against target for percentages. Large numbers are impactful for counts. Sparklines offer a quick trend overview without clutter. Detail modals provide comprehensive context on demand.
        - Risk/Opportunity Cards (KPI & ความเสี่ยง section): Goal: Inform, Organize. Viz: Color-coded cards based on type (Risk/Opportunity) and level (สูง/ปานกลาง/ต่ำ). Interaction: "ดูรายละเอียด" button to open a modal with full details (issue, cause, likelihood, impact, mitigation). Justification: Cards are effective for categorizing and summarizing discrete items. Modals allow for in-depth exploration without leaving the main view.
        - Risk/Opportunity Summary Chart (KPI & ความเสี่ยง section): Goal: Summarize, Compare. Viz: Bar Chart (Chart.js Bar). Interaction: Hover tooltip to show specific issues within each level. Justification: Provides an aggregate view of risk/opportunity distribution by level, helping to identify areas of concern or potential.
        - Combined Trend Chart (แนวโน้มรวม section): Goal: Compare, Change. Viz: Line Chart (Chart.js Line). Interaction: Tooltips for data points. Justification: Shows the overall trend of multiple KPIs over time, allowing for macro-level performance analysis.
        - Process Errors Trend Chart (แนวโน้มรวม section): Goal: Inform, Change. Viz: Separate Line Chart (Chart.js Line). Interaction: Tooltips for data points. Justification: Isolating this critical KPI allows for dedicated focus on its trend, which is often a key area for improvement.
        - Quiz Buttons (ข้อสอบ section): Goal: Engage, Test. Viz: Styled buttons. Interaction: Click to open external Google Forms in a new tab. Justification: Provides direct access to training/assessment resources.
        - Document Links (แบบฟอร์มเอกสาร section): Goal: Inform, Access. Viz: Styled links. Interaction: Click to open external Google Sheets/Drive links in a new tab. Justification: Centralizes access to important operational documents.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Sarabun', sans-serif;
            background-image: url('https://www.sahapvc1980.com/images/banner/pharma_phamapack0436_1.webp'); /* รูปภาพพื้นหลัง */
            background-size: cover; /* คลุมพื้นที่ทั้งหมด */
            background-repeat: no-repeat; /* ไม่ซ้ำรูปภาพ */
            background-attachment: fixed; /* พื้นหลังคงที่เมื่อเลื่อนหน้าจอ */
            background-position: center center; /* จัดตำแหน่งรูปภาพพื้นหลังตรงกลาง */
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 300px; /* Adjusted max-width */
            height: 20vh; /* Responsive height */
            max-height: 200px; /* Max height for larger screens */
            margin: 0 auto;
        }
        .sparkline-container {
            position: relative;
            width: 100%;
            height: 10vh; /* Responsive height */
            max-height: 100px; /* Max height */
            margin-top: 10px;
        }
        .chart-container-line {
            position: relative;
            width: 100%;
            height: 35vh; /* Responsive height */
            max-height: 400px; /* Max height for larger screens */
            margin: 0 auto;
        }
        .modal-content {
            max-height: 80vh;
        }
        .kpi-value-lg {
            font-size: 4rem;
            line-height: 1;
        }
        .section-hidden {
            display: none;
        }
        .text-shadow-subtle {
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
        }
        .loading-overlay {
            position: fixed;
            inset: 0;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #3b82f6;
            animation: spin 1s ease infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="text-white">
    <!-- Loading Overlay (kept for potential future use or initial loading, but currently not actively used as Firebase is removed) -->
    <div id="loading-overlay" class="loading-overlay hidden">
        <div class="spinner"></div>
    </div>

    <div class="container mx-auto p-4 sm:p-6 md:p-8">
        <header class="text-center mb-10">
            <h1 class="text-3xl sm:text-4xl md:text-5xl font-bold text-white text-shadow-subtle">วัตถุประสงค์คุณภาพ (KPI)</h1>
            <p class="text-xl text-white text-shadow-subtle mt-2">แผนกคลังสินค้า ประจำปี 2568</p>
            <div class="w-24 h-1 bg-teal-500 mx-auto mt-4 rounded"></div>
        </header>

        <!-- Navigation Menu -->
        <nav class="mb-8 flex justify-center space-x-6">
            <button id="nav-kpi-risk" class="text-lg font-semibold text-blue-900 hover:text-blue-900 transition-colors py-2 px-4 rounded-lg bg-blue-300 shadow-md">
                KPI & ความเสี่ยง
            </button>
            <button id="nav-combined-trend" class="text-lg font-semibold text-blue-700 hover:text-blue-900 transition-colors py-2 px-4 rounded-lg bg-blue-100 shadow-md">
                แนวโน้มรวม
            </button>
            <button id="nav-quiz" class="text-lg font-semibold text-blue-700 hover:text-blue-900 transition-colors py-2 px-4 rounded-lg bg-blue-100 shadow-md">
                ข้อสอบ
            </button>
            <button id="nav-document-forms" class="text-lg font-semibold text-blue-700 hover:text-blue-900 transition-colors py-2 px-4 rounded-lg bg-blue-100 shadow-md">
                แบบฟอร์มเอกสาร
            </button>
        </nav>

        <section id="kpi-risk-section">
            <!-- Company Policy Section -->
            <div class="bg-white bg-opacity-75 rounded-xl shadow-lg p-6 mb-12 text-center">
                <h2 class="text-3xl sm:text-4xl font-bold text-black mb-4 text-shadow-subtle">นโยบายคุณภาพ</h2>
                <p class="text-xl sm:text-2xl font-semibold text-gray-900 leading-relaxed text-shadow-subtle">
                    “ผลิตสินค้าที่มีคุณภาพ ตรงตามความต้องการของลูกค้า ส่งมอบทันเวลา
                    พัฒนาปรับปรุงอย่างต่อเนื่องเพื่อความพึงพอใจของลูกค้า”
                </p>
                <p class="text-sm text-gray-700 mt-4 text-shadow-subtle">
                    ประกาศ ณ วันที่ 1 มีนาคม พ.ศ.2567
                </p>
            </div>

            <div class="mb-6 flex justify-center items-center">
                <label for="month-select" class="mr-3 text-lg font-semibold text-white text-shadow-subtle">เลือกเดือน:</label>
                <select id="month-select" class="p-2 border border-blue-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors text-gray-800">
                </select>
            </div>

            <main id="kpi-grid" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-8">
            </main>

            <section class="mt-16">
                <h2 class="text-3xl sm:text-4xl font-bold text-white text-center mb-8 text-shadow-subtle">การประเมินความเสี่ยงและโอกาส</h2>
                <p class="text-lg text-white text-center mb-10 max-w-3xl mx-auto text-shadow-subtle">
                    ส่วนนี้แสดงการวิเคราะห์ความเสี่ยงและโอกาสที่สำคัญในแผนกคลังสินค้า โดยประเมินจากโอกาสที่จะเกิดขึ้นและผลกระทบ เพื่อให้เข้าใจถึงระดับความสำคัญและมาตรการที่จำเป็น
                </p>

                <div id="risk-opportunity-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-12">
                </div>

                <!-- Separate Risk and Opportunity Charts -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-12">
                    <div class="bg-white bg-opacity-75 rounded-xl shadow-lg p-6">
                        <h3 class="text-2xl font-bold text-black mb-6 text-center text-shadow-subtle">สรุประดับความเสี่ยง</h3>
                        <div class="chart-container-line">
                            <canvas id="riskSummaryChart"></canvas>
                        </div>
                        <p class="text-center text-gray-900 mt-4 text-shadow-subtle">แผนภูมิแสดงการกระจายของระดับความเสี่ยง (วางเมาส์บนแท่งเพื่อดูรายละเอียด)</p>
                    </div>
                    <div class="bg-white bg-opacity-75 rounded-xl shadow-lg p-6">
                        <h3 class="text-2xl font-bold text-black mb-6 text-center text-shadow-subtle">สรุประดับโอกาส</h3>
                        <div class="chart-container-line">
                            <canvas id="opportunitySummaryChart"></canvas>
                        </div>
                        <p class="text-center text-gray-900 mt-4 text-shadow-subtle">แผนภูมิแสดงการกระจายของระดับโอกาส (วางเมาส์บนแท่งเพื่อดูรายละเอียด)</p>
                    </div>
                </div>

                <div class="bg-white bg-opacity-75 rounded-xl shadow-lg p-6">
                    <h3 class="text-2xl font-bold text-black mb-6 text-shadow-subtle">ตารางจัดลำดับความเสี่ยงและโอกาส</h3>
                    <div class="overflow-x-auto">
                        <table class="min-w-full bg-white bg-opacity-75 border border-gray-200 rounded-lg">
                            <thead>
                                <tr class="bg-blue-100 text-blue-800 uppercase text-sm leading-normal">
                                    <th class="py-3 px-6 text-left">ระดับคะแนน</th>
                                    <th class="py-3 px-6 text-left">ระดับความเสี่ยง และโอกาส</th>
                                    <th class="py-3 px-6 text-left">การดำเนินงาน</th>
                                </tr>
                            </thead>
                            <tbody class="text-gray-900 text-sm font-light text-shadow-subtle">
                                <tr class="border-b border-gray-200 hover:bg-gray-100">
                                    <td class="py-3 px-6 text-left whitespace-nowrap">1-5</td>
                                    <td class="py-3 px-6 text-left">ต่ำ</td>
                                    <td class="py-3 px-6 text-left">ไม่ดำเนินการใดๆ</td>
                                </tr>
                                <tr class="border-b border-gray-200 hover:bg-gray-100">
                                    <td class="py-3 px-6 text-left whitespace-nowrap">6-10</td>
                                    <td class="py-3 px-6 text-left">ปานกลาง</td>
                                    <td class="py-3 px-6 text-left">เฝ้าระวัง และต้องนำมาทบทวนใหม่ในครั้งหน้า</td>
                                </tr>
                                <tr class="hover:bg-gray-100">
                                    <td class="py-3 px-6 text-left whitespace-nowrap">11-15</td>
                                    <td class="py-3 px-6 text-left">สูง</td>
                                    <td class="py-3 px-6 text-left">จัดทำแผนงาน (Action Plan)</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
        </section>

        <!-- Combined Trend Section (New) -->
        <section id="combined-trend-section" class="mt-16 section-hidden">
            <h2 class="text-3xl sm:text-4xl font-bold text-white text-center mb-8 text-shadow-subtle">แนวโน้มรวมของ KPI ทั้งหมด</h2>
            <p class="text-lg text-white text-center mb-10 max-w-3xl mx-auto text-shadow-subtle">
                แผนภูมิแสดงแนวโน้มรายเดือนของ KPI แต่ละตัว เพื่อการวิเคราะห์ภาพรวมและแนวโน้มในระยะยาว
            </p>
            <div id="individual-trend-charts-container" class="space-y-8">
                <!-- Individual KPI trend charts will be dynamically added here -->
            </div>
        </section>

        <!-- Quiz Section -->
        <section id="quiz-section" class="mt-16 section-hidden">
            <h2 class="text-3xl sm:text-4xl font-bold text-white text-center mb-8 text-shadow-subtle">แบบทดสอบสำหรับตำแหน่งต่างๆ</h2>
            <p class="text-lg text-white text-center mb-10 max-w-3xl mx-auto text-shadow-subtle">
                เลือกแบบทดสอบตามตำแหน่งที่คุณต้องการฝึกฝนความรู้ความเข้าใจ
            </p>

            <div class="space-y-12">
                <div class="bg-white bg-opacity-75 rounded-xl shadow-lg p-6 text-center">
                    <h3 class="text-2xl font-bold text-black mb-6 text-shadow-subtle">1. แบบทดสอบพนักงานเก็บสินค้าในไลน์ผลิต</h3>
                    <button class="quiz-button bg-blue-500 text-white font-semibold py-3 px-8 rounded-lg hover:bg-blue-600 transition-colors shadow-md" data-quiz-url="https://forms.gle/GjgDKJ7Pqi8vvpRE7">
                        ทำแบบทดสอบ
                    </button>
                </div>

                <div class="bg-white bg-opacity-75 rounded-xl shadow-lg p-6 text-center">
                    <h3 class="text-2xl font-bold text-black mb-6 text-shadow-subtle">2. แบบทดสอบพนักงานจัดเตรียมสินค้าส่งออก</h3>
                    <button class="quiz-button bg-blue-500 text-white font-semibold py-3 px-8 rounded-lg hover:bg-blue-600 transition-colors shadow-md" data-quiz-url="https://forms.gle/MwdmKPsZYuHBajU17">
                        ทำแบบทดสอบ
                    </button>
                </div>

                <div class="bg-white bg-opacity-75 rounded-xl shadow-lg p-6 text-center">
                    <h3 class="text-2xl font-bold text-black mb-6 text-shadow-subtle">3. แบบทดสอบพนักงานเบิกจ่ายวัสดุประกอบ</h3>
                    <button class="quiz-button bg-blue-500 text-white font-semibold py-3 px-8 rounded-lg hover:bg-blue-600 transition-colors shadow-md" data-quiz-url="https://forms.gle/3f9x5tjSKQ2ZgZj8A">
                        ทำแบบทดสอบ
                    </button>
                </div>
            </div>
        </section>

        <!-- Document Forms Section (New) -->
        <section id="document-forms-section" class="mt-16 section-hidden">
            <h2 class="text-3xl sm:text-4xl font-bold text-white text-center mb-8 text-shadow-subtle">แบบฟอร์มเอกสารในแผนก</h2>
            <p class="text-lg text-white text-center mb-10 max-w-3xl mx-auto text-shadow-subtle">
                ส่วนนี้จะรวบรวมแบบฟอร์มเอกสารที่สำคัญสำหรับการปฏิบัติงานในแผนกคลังสินค้า
            </p>

            <div class="space-y-6">
                <div class="bg-white bg-opacity-75 rounded-xl shadow-lg p-6 text-center">
                    <h3 class="text-2xl font-bold text-black mb-4 text-shadow-subtle">วัตถุประสงค์คุณภาพ (KPI) แผนกคลังสินค้า (saha p.v.c.1980)</h3>
                    <p class="text-gray-900 mb-4 text-shadow-subtle">
                        (เอกสารนี้เป็น Google Sheet)
                    </p>
                    <a href="https://docs.google.com/spreadsheets/d/1a6DdbnbNaNLjXZg4MncuK9mwOWlrwTQizzngf27TgLg/edit?usp=sharing" target="_blank" class="inline-block bg-blue-500 text-white font-semibold py-2 px-6 rounded-lg hover:bg-blue-600 transition-colors shadow-md">
                        เปิด Google Sheet
                    </a>
                </div>

                <div class="bg-white bg-opacity-75 rounded-xl shadow-lg p-6 text-center">
                    <h3 class="text-2xl font-bold text-black mb-6 text-shadow-subtle">เพิ่มแบบฟอร์มเอกสารอื่นๆ</h3>
                    <p class="text-xl text-gray-900 mb-4 text-shadow-subtle">
                        หากคุณต้องการเพิ่มแบบฟอร์มเอกสารอื่นๆ กรุณาอัปโหลดไฟล์ไปยัง Google Drive และทำตามขั้นตอนการรับลิงก์สำหรับแชร์
                    </p>
                    <p class="text-gray-900 mt-4 text-shadow-subtle">
                        จากนั้นแจ้งชื่อแบบฟอร์มและ **ลิงก์ Google Drive** มาให้ผมได้เลยครับ ผมจะช่วยเพิ่มลงในหน้านี้ให้
                    </p>
                </div>
            </div>
        </section>
    </div>

    <!-- Details Modal -->
    <div id="kpi-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 hidden">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-2xl transform transition-all duration-300 scale-95 opacity-0">
            <div class="modal-content overflow-y-auto p-6">
                <div class="flex justify-between items-start mb-4">
                    <h2 id="modal-title" class="text-2xl font-bold text-black text-shadow-subtle"></h2>
                    <button id="modal-close-btn" class="text-gray-500 hover:text-gray-800 transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                    </button>
                </div>
                <div id="modal-body" class="space-y-4 text-gray-900 text-shadow-subtle">
                </div>
            </div>
        </div>
    </div>

    <!-- Risk/Opportunity Details Modal -->
    <div id="ro-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 hidden">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-2xl transform transition-all duration-300 scale-95 opacity-0">
            <div class="modal-content overflow-y-auto p-6">
                <div class="flex justify-between items-start mb-4">
                    <h2 id="ro-modal-title" class="text-2xl font-bold text-black text-shadow-subtle"></h2>
                    <button id="ro-modal-close-btn" class="text-gray-500 hover:text-gray-800 transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                    </button>
                </div>
                <div id="ro-modal-body" class="space-y-4 text-gray-900 text-shadow-subtle">
                </div>
            </div>
        </div>
    </div>

    <script>
        // ข้อมูล KPI ของแต่ละเดือน คุณสามารถแก้ไขข้อมูลในส่วนนี้ได้โดยตรง
        const kpiData = [
            {
                id: 'stockAccuracy',
                title: 'ความถูกต้องของสต็อกสินค้า',
                type: 'percentage',
                unit: '%',
                details: {
                    indicator: 'เปอร์เซ็นต์ความถูกต้องของสต๊อกสินค้า',
                    frequency: 'ทุกเดือน',
                    evaluation: 'ดูผลการตรวจนับสต็อกสินค้าจากรายงาน KPI ประจำปี (FM-AC-01-03)',
                    levels: [
                        { score: 5, value: '100%', color: 'text-emerald-500' },
                        { score: 4, value: '>98%', color: 'text-green-500' },
                        { score: 3, value: '98%', color: 'text-blue-500' },
                        { score: 2, value: '<98%', color: 'text-amber-500' },
                        { score: 1, value: '<96%', color: 'text-rose-500' }
                    ]
                },
                monthlyData: {
                     '0': { currentValue: 100, target: 98 }, // ม.ค.
                    '1': { currentValue: 100, target: 98 }, // ก.พ.
                    '2': { currentValue: 100, target: 98 }, // มี.ค.
                    '3': { currentValue: 99.34, target: 98 }, // เม.ย.
                    '4': { currentValue: 98.57, target: 98 }, // พ.ค.
                    '5': { currentValue: 99.38, target: 98 }  // มิ.ย.
                }
            },
            {
                id: 'productCompleteness',
                title: 'ความถูกต้องและสมบูรณ์ของสินค้า',
                type: 'percentage',
                unit: '%',
                details: {
                    indicator: 'เปอร์เซ็นต์ความถูกต้องและสมบูรณ์ของสินค้าที่จัดเตรียมให้ขนส่ง',
                    frequency: 'ทุกเดือน',
                    evaluation: 'ดูจากใบส่งสินค้า/ใบเบิก/ใบจ่ายสินค้าเพื่อจัดส่ง (FM-PL-01-10) แล้วใช้สูตรการคิด [(รายการสินค้าที่ตรวจสอบได้ถูกต้องและสมบูรณ์) ÷ (รายการสินค้าที่จัดเตรียมให้ขนส่ง)] x 100',
                     levels: [
                        { score: 5, value: '100%', color: 'text-emerald-500' },
                        { score: 4, value: '>98%', color: 'text-green-500' },
                        { score: 3, value: '98%', color: 'text-blue-500' },
                        { score: 2, value: '<98%', color: 'text-amber-500' },
                        { score: 1, value: '<96%', color: 'text-rose-500' }
                    ]
                },
                monthlyData: {
                    '0': { currentValue: 100, target: 98 },
                    '1': { currentValue: 100, target: 98 },
                    '2': { currentValue: 99.41, target: 98 },
                    '3': { currentValue: 98.96, target: 98 },
                    '4': { currentValue: 99.46, target: 98 },
                    '5': { currentValue: 100, target: 98 }
                }
            },
            {
                id: 'processErrors',
                title: 'ข้อผิดพลาดในกระบวนการทำงาน',
                type: 'count',
                unit: 'ครั้ง',
                lowerIsBetter: true,
                details: {
                    indicator: 'จำนวนครั้งที่พบผลิตภัณฑ์ที่ไม่เป็นไปตามข้อกำหนด / ข้อผิดพลาดในกระบวนการทำงาน',
                    frequency: 'ทุกเดือน',
                    evaluation: 'ดูจากใบ NCR (FM-QC-01-11), ใบรับสินค้ามีปัญหาจากลูกค้า (FM-WA-01-07), ใบขอบดสินค้ากรณีพบงานมีปัญหา (FM-WA-01-09), CAR (FM-SPVC-01-12) และใบบันทึกข้อผิดพลาดในกระบวนการผลิต (FM-SE-01-01)',
                    levels: [
                        { score: 5, value: '<3 ครั้ง', color: 'text-emerald-500' },
                        { score: 4, value: '3 ครั้ง', color: 'text-green-500' },
                        { score: 3, value: '4 ครั้ง', color: 'text-blue-500' },
                        { score: 2, value: '5 ครั้ง', color: 'text-amber-500' },
                        { score: 1, value: '>5 ครั้ง', color: 'text-rose-500' }
                    ]
                },
                monthlyData: {
                    '0': { currentValue: '-', target: 4 },
                    '1': { currentValue: '-', target: 4 },
                    '2': { currentValue: 4, target: 4 },
                    '3': { currentValue: 3, target: 4 },
                    '4': { currentValue: 3, target: 4 },
                    '5': { currentValue: 2, target: 4 }
                }
            },
            {
                id: 'inspectionReadiness',
                title: 'การเตรียมสินค้าพร้อมตรวจ',
                type: 'percentage',
                unit: '%',
                details: {
                    indicator: 'สินค้าที่ได้รับการตรวจสอบก่อนจัดส่ง',
                    frequency: 'ทุกเดือน',
                    evaluation: 'ดูจากใบส่งสินค้า/ใบเบิก/ใบจ่ายสินค้าเพื่อจัดส่ง (FM-PL-01-10) แล้วใช้สูตรการคิด [(รายการจัดเตรียมสินค้าทั้งหมด) - (จำนวนครั้งที่ไม่ได้ตรวจก่อนจัดส่ง)] ÷ (รายการสินค้าที่จัดส่งทั้งเดือน) x 100',
                     levels: [
                        { score: 5, value: '100%', color: 'text-emerald-500' },
                        { score: 4, value: '>95%', color: 'text-green-500' },
                        { score: 3, value: '95%', color: 'text-blue-500' },
                        { score: 2, value: '<95%', color: 'text-amber-500' },
                        { score: 1, value: '<90%', color: 'text-rose-500' }
                    ]
                },
                 monthlyData: {
                    '0': { currentValue: '-', target: 95 },
                    '1': { currentValue: '-', target: 95 },
                    '2': { currentValue: 98.83, target: 95 },
                    '3': { currentValue: 99.01, target: 95 },
                    '4': { currentValue: 97.88, target: 95 },
                    '5': { currentValue: 98.75, target: 95 }
                }
            }
        ];

        const riskOpportunityData = [
            {
                id: 'risk1',
                type: 'Risk',
                issue: 'พื้นที่จัดเก็บสินค้าไม่เพียงพอ',
                cause: '(R) พื้นที่ในการจัดเก็บมีไม่เพียงพอหากมีการสั่งซื้อสินค้าจำนวนมากและการจัดส่งขึ้นอยู่กับความต้องการของลูกค้า',
                likelihood_score: 4,
                impact_score: 3,
                level: '',
                mitigation: 'วางแผนการใช้พื้นที่ในการจัดเก็บสินค้าให้มีประสิทธิภาพสูงสุด',
                likelihood_desc: '',
                impact_desc: ''
            },
            {
                id: 'opp1',
                type: 'Opportunity',
                issue: 'พื้นที่จัดเก็บสินค้า',
                cause: '(O) สามารถจัดเก็บสินค้าเพื่อรองรับต่อความต้องการของลูกค้า',
                likelihood_score: 3,
                impact_score: 3,
                level: '',
                mitigation: 'วางแผนการใช้พื้นที่ในการจัดเก็บสินค้าให้มีประสิทธิภาพสูงสุด',
                likelihood_desc: '',
                impact_desc: ''
            },
            {
                id: 'risk2',
                type: 'Risk',
                issue: 'การจัดเก็บสินค้าในอุณหภูมิที่ไม่คงที่',
                cause: '(R) สินค้าบางชนิดอาจเสื่อมสภาพเร็วขึ้น เช่น เปลี่ยนสี เปราะแตก สูญเสียความยืดหยุ่น เสียรูปทรงบิดเบี้ยว',
                likelihood_score: 2,
                impact_score: 2,
                level: '',
                mitigation: 'เลือกจัดเก็บผลิตภัณฑ์ที่ทนต่อการเปลี่ยนแปลงของอุณหภูมิ',
                likelihood_desc: '',
                impact_desc: ''
            },
            {
                id: 'risk3',
                type: 'Risk',
                issue: 'การโยนสินค้าจัดเก็บบนที่สูง',
                cause: '(R) สินค้าอาจเสียหายจากการกระแทกกับสิ่งของในขณะโยนหรือหล่นจากที่สูง',
                likelihood_score: 3,
                impact_score: 3,
                level: '',
                mitigation: 'อบรมผู้ปฏิบัติงานให้มีความรู้และทักษะในการโยนสินค้าอย่างปลอดภัย',
                likelihood_desc: '',
                impact_desc: ''
            },
            {
                id: 'risk4',
                type: 'Risk',
                issue: 'การเคลื่อนย้ายสินค้าบนพื้นที่ต่างระดับ',
                cause: '(R) สินค้าอาจร่วงหล่นในขณะเคลื่อนย้ายสินค้า ลื่นไถลบนพื้นที่ลาดชัน',
                likelihood_score: 3,
                impact_score: 3,
                level: '',
                mitigation: 'อบรมผู้ปฏิบัติงานให้มีความรู้และทักษะในการเคลื่อนย้ายสินค้าอย่างปลอดภัย',
                likelihood_desc: '',
                impact_desc: ''
            }
        ];

        const riskLikelihoodLevels = {
            5: 'สูงมาก: เคยเกิดขึ้นทุกวันหรือเกือบทุกวัน',
            4: 'สูง: เคยเกิดขึ้นทุกสัปดาห์หรือเกือบทุกสัปดาห์',
            3: 'ปานกลาง: เคยเกิดขึ้นทุกเดือนหรือเกือบทุกเดือน',
            2: 'น้อย: เคยเกิดขึ้นทุกปีหรือเกือบทุกปี',
            1: 'น้อยมาก: ไม่เคยเกิดขึ้นในรอบ 5 ปี หรือยังไม่เคยเกิดขึ้น'
        };

        const riskImpactLevels = {
            3: 'มาก: ลูกค้าไม่พึงพอใจ บริษัทฯ มาก / ถูกลูกค้าร้องเรียน / ส่งผลกระทบบริษัทฯ เสียชื่อเสียงมาก / ทำผิดกฎหมาย / ระบบล้มเหลวอย่างสิ้นเชิง / ทรัพย์สินเสียหายจำนวนมาก / กระทบต่อสิ่งแวดล้อมจำนวนมาก / พนักงานเสียชีวิต',
            2: 'ปานกลาง: ความพึงพอใจลูกค้าลดลง / มีแนวโน้ม ที่จะถูกร้องเรียน / มีแนวโน้มจะทำให้ผิดหรือเกือบผิดกฎหมาย / ระบบไม่มีประสิทธิผล / กระทบต่อสิ่งแวดล้อมเล็กน้อย / พนักงาน หรือผู้เกี่ยวข้องบาดเจ็บ ต้องเข้าพักรักษาตัว',
            1: 'น้อย: ระบบไม่ได้ผลตามต้องการหรือล่าช้าไปบ้าง แต่ยังสามารถควบคุมได้'
        };

        const opportunityLikelihoodLevels = {
            5: 'สูงมาก: โอกาสสำเร็จ > 80% หรือภายใน 6 เดือน',
            4: 'สูง: โอกาสสำเร็จ > 50-80% หรือภายใน 6-12 เดือน',
            3: 'ปานกลาง: โอกาสสำเร็จ 50% หรือภายใน 2 ปี',
            2: 'น้อย: โอกาสสำเร็จ < 50-20% หรือภายใน 3-4 ปี',
            1: 'น้อยมาก: โอกาสสำเร็จ < 20% หรือมากกว่า 4 ปี'
        };

        const opportunityImpactLevels = {
            3: 'มาก: ลูกค้าพึงพอใจ บริษัทฯ มาก / ลูกค้าบอกต่อ / ส่งผลกระทบต่อชื่อเสียงของบริษัทฯ ดีขึ้นมาก / ทำให้ระบบฯ มีประสิทธิผลดีขึ้นมาก / ได้กำไรเพิ่มขึ้นเป็นจำนวนมาก / พนักงานมีความสุขในปฏิบัติงานมาก',
            2: 'ปานกลาง: ลูกค้าพึงพอใจ บริษัทฯ เล็กน้อย / ส่งผลกระทบต่อชื่อเสียงของบริษัทฯ ดีขึ้นเล็กน้อย / ทำให้ระบบฯ มีประสิทธิผลดีขึ้นเล็กน้อย / ได้กำไรเพิ่มขึ้นเล็กน้อย / พนักงานมีความสุขในปฏิบัติงานปานกลาง',
            1: 'น้อย: คงทำให้ระบบฯ ได้รับการรับรองต่อเนื่อง / พนักงานมีความสุขในปฏิบัติงานน้อย'
        };

        // คำนวณระดับความเสี่ยง/โอกาส
        function calculateLevel(type, likelihood, impact) {
            const score = likelihood * impact;
            if (type === 'Risk') {
                if (score >= 11) return 'สูง';
                if (score >= 6) return 'ปานกลาง';
                return 'ต่ำ';
            } else if (type === 'Opportunity') {
                if (score >= 11) return 'สูง';
                if (score >= 6) return 'ปานกลาง';
                return 'ต่ำ';
            }
            return 'N/A';
        }

        // กำหนดระดับและคำอธิบายสำหรับข้อมูลความเสี่ยง/โอกาส
        riskOpportunityData.forEach(item => {
            item.level = calculateLevel(item.type, item.likelihood_score, item.impact_score);
            if (item.type === 'Risk') {
                item.likelihood_desc = riskLikelihoodLevels[item.likelihood_score];
                item.impact_desc = riskImpactLevels[item.impact_score];
            } else if (item.type === 'Opportunity') {
                item.likelihood_desc = opportunityLikelihoodLevels[item.likelihood_score];
                item.impact_desc = opportunityImpactLevels[item.impact_score];
            }
        });


        const kpiCharts = {}; // เก็บ instance ของ Chart.js เพื่อทำลายและสร้างใหม่
        let lineChartInstance = null; // เก็บ instance ของ Line Chart ใน Modal
        let riskSummaryChartInstance = null; // เก็บ instance ของ Risk Summary Chart
        let opportunitySummaryChartInstance = null; // เก็บ instance ของ Opportunity Summary Chart
        let individualTrendChartInstances = {}; // เก็บ instance ของ Line Chart สำหรับแต่ละ KPI

        const kpiRiskSection = document.getElementById('kpi-risk-section');
        const combinedTrendSection = document.getElementById('combined-trend-section');
        const quizSection = document.getElementById('quiz-section');
        const documentFormsSection = document.getElementById('document-forms-section');

        const navKpiRiskBtn = document.getElementById('nav-kpi-risk');
        const navCombinedTrendBtn = document.getElementById('nav-combined-trend');
        const navQuizBtn = document.getElementById('nav-quiz');
        const navDocumentFormsBtn = document.getElementById('nav-document-forms');

        const grid = document.getElementById('kpi-grid');
        const modal = document.getElementById('kpi-modal');
        const modalContent = modal.querySelector('.bg-white');
        const modalTitle = document.getElementById('modal-title');
        const modalBody = document.getElementById('modal-body');
        const modalCloseBtn = document.getElementById('modal-close-btn');
        const monthSelect = document.getElementById('month-select');
        const loadingOverlay = document.getElementById('loading-overlay'); 

        const riskOpportunityGrid = document.getElementById('risk-opportunity-grid');
        const roModal = document.getElementById('ro-modal');
        const roModalContent = roModal.querySelector('.bg-white');
        const roModalTitle = document.getElementById('ro-modal-title');
        const roModalBody = document.getElementById('ro-modal-body');
        const roModalCloseBtn = document.getElementById('ro-modal-close-btn');

        let currentMonthIndex = 0; // ติดตามเดือนที่เลือกปัจจุบัน
        const monthNames = ['ม.ค.', 'ก.พ.', 'มี.ค.', 'เม.ย.', 'พ.ค.', 'มิ.ย.', 'ก.ค.', 'ส.ค.', 'ก.ย.', 'ต.ค.', 'พ.ย.', 'ธ.ค.'];

        // ฟังก์ชันสร้าง Gauge Chart
        const createGaugeChart = (canvasId, value, target, unit) => {
            const ctx = document.getElementById(canvasId);
            if (!ctx) return;
            const max = target > 100 ? target * 1.2 : 100;
            const data = {
                datasets: [{
                    data: [target, max - target],
                    backgroundColor: ['#e0e0e0', '#bdbdbd'], // สีเทาสำหรับพื้นหลังเป้าหมาย
                    borderWidth: 0,
                    circumference: 180,
                    rotation: 270,
                }, {
                    data: [value, max - value],
                    backgroundColor: [getPerformanceColor(value, target, false), 'rgba(0,0,0,0)'], // สีค่าจริง
                    borderWidth: 0,
                    circumference: 180,
                    rotation: 270,
                }]
            };

            // ทำลาย Chart เก่าก่อนสร้างใหม่ เพื่อป้องกันปัญหา memory leaks
            if (kpiCharts[canvasId]) {
                kpiCharts[canvasId].destroy();
            }

            kpiCharts[canvasId] = new Chart(ctx, {
                type: 'doughnut',
                data: data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: {
                        tooltip: { enabled: false },
                        legend: { display: false }
                    },
                    animation: {
                       animateRotate: false // แอนิเมชันการเติบโตเท่านั้น ไม่ใช่การหมุน
                    }
                },
                 plugins: [{
                    id: 'textCenter',
                    afterDraw: (chart) => {
                        let ctx = chart.ctx;
                        ctx.save();
                        let centerX = (chart.chartArea.left + chart.chartArea.right) / 2;
                        let centerY = (chart.chartArea.top + chart.chartArea.bottom) / 1.5; // ปรับ Y สำหรับตำแหน่งข้อความ
                        ctx.fillStyle = '#000000'; // สีดำสำหรับค่า
                        ctx.textAlign = 'center';
                        ctx.textBaseline = 'baseline';
                        ctx.font = 'bold 2.5rem Sarabun';
                        ctx.fillText(value + unit, centerX, centerY);
                        ctx.font = 'normal 1rem Sarabun';
                        ctx.fillStyle = '#000000'; // สีดำสำหรับเป้าหมาย
                        ctx.fillText(`เป้าหมาย: ${target}${unit}`, centerX, centerY + 24);
                        ctx.restore();
                    }
                }]
            });
        };

        // ฟังก์ชันสร้าง Sparkline Chart
        const createSparklineChart = (canvasId, currentValues, targetValues, unit, lineColorForCurrent) => {
            const ctx = document.getElementById(canvasId);
            if (!ctx) return;

            if (kpiCharts[canvasId]) {
                kpiCharts[canvasId].destroy();
            }

            // แสดงข้อมูลย้อนหลัง 6 เดือน รวมถึงเดือนปัจจุบัน
            const labels = monthNames.slice(Math.max(0, currentMonthIndex - 5), currentMonthIndex + 1);
            const dataSliceCurrent = currentValues.slice(Math.max(0, currentMonthIndex - 5), currentMonthIndex + 1);
            const dataSliceTarget = targetValues.slice(Math.max(0, currentMonthIndex - 5), currentMonthIndex + 1);


            kpiCharts[canvasId] = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'ค่าปัจจุบัน',
                            data: dataSliceCurrent,
                            borderColor: lineColorForCurrent,
                            backgroundColor: lineColorForCurrent + '40',
                            borderWidth: 2,
                            pointRadius: 3,
                            tension: 0.4,
                            fill: true
                        },
                        {
                            label: 'เป้าหมาย',
                            data: dataSliceTarget,
                            borderColor: '#14b8a6',
                            backgroundColor: 'rgba(0,0,0,0)',
                            borderWidth: 1,
                            pointRadius: 0,
                            borderDash: [2, 2],
                            tension: 0.4,
                            fill: false
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: { enabled: false } // ปิด tooltip สำหรับ sparkline
                    },
                    scales: {
                        x: {
                            display: true,
                            grid: { display: false },
                            ticks: {
                                font: { size: 8, family: 'Sarabun' },
                                maxRotation: 0,
                                minRotation: 0,
                                color: '#000000'
                            }
                        },
                        y: {
                            display: true,
                            grid: { display: false },
                            ticks: {
                                font: { size: 8, family: 'Sarabun' },
                                color: '#000000'
                            }
                        }
                    },
                    elements: {
                        line: {
                            borderCapStyle: 'round'
                        }
                    }
                }
            });
        };

        // ฟังก์ชันสร้าง Line Chart สำหรับ Modal รายละเอียด
        const createLineChart = (canvasId, labels, currentValues, targetValues, unit) => {
            const ctx = document.getElementById(canvasId);
            if (!ctx) return;

            if (lineChartInstance) {
                lineChartInstance.destroy();
            }

            lineChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'ค่าปัจจุบัน',
                            data: currentValues,
                            borderColor: '#0284c7',
                            backgroundColor: 'rgba(2, 132, 199, 0.2)',
                            fill: true,
                            tension: 0.3,
                            pointRadius: 5,
                            pointBackgroundColor: '#0284c7',
                            pointBorderColor: '#fff',
                            pointHoverRadius: 7,
                            pointHoverBackgroundColor: '#0284c7',
                            pointHoverBorderColor: '#fff'
                        },
                        {
                            label: 'เป้าหมาย',
                            data: targetValues,
                            borderColor: '#14b8a6',
                            backgroundColor: 'rgba(20, 184, 166, 0.1)',
                            fill: false,
                            tension: 0.3,
                            pointRadius: 0,
                            borderDash: [5, 5]
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                font: {
                                    family: 'Sarabun',
                                    color: '#000000'
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        label += context.parsed.y + unit;
                                    }
                                    return label;
                                }
                            },
                            titleFont: { family: 'Sarabun', size: 14 },
                            bodyFont: { family: 'Sarabun', size: 12 }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'เดือน',
                                font: { family: 'Sarabun', color: '#000000' }
                            },
                            ticks: {
                                font: { family: 'Sarabun', color: '#000000' }
                            }
                        },
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: `ค่า (${unit})`,
                                font: { family: 'Sarabun', color: '#000000' }
                            },
                            ticks: {
                                font: { family: 'Sarabun', color: '#000000' }
                            }
                        }
                    }
                }
            });
        };

        // New function for individual line charts
        const createIndividualLineChart = (canvasId, labels, currentValues, targetValues, unit, kpiTitle, lowerIsBetter) => {
            const ctx = document.getElementById(canvasId);
            if (!ctx) return;

            if (individualTrendChartInstances[canvasId]) {
                individualTrendChartInstances[canvasId].destroy();
            }

            // Determine target line color based on lowerIsBetter for consistency
            const targetLineColor = lowerIsBetter ? '#ef4444' : '#14b8a6'; // Red for lowerIsBetter target, Green otherwise

            individualTrendChartInstances[canvasId] = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'ค่าปัจจุบัน',
                            data: currentValues,
                            borderColor: '#0284c7', // Blue for current value
                            backgroundColor: 'rgba(2, 132, 199, 0.2)',
                            fill: true,
                            tension: 0.3,
                            pointRadius: 5,
                            pointBackgroundColor: '#0284c7',
                            pointBorderColor: '#fff',
                            pointHoverRadius: 7,
                            pointHoverBackgroundColor: '#0284c7',
                            pointHoverBorderColor: '#fff'
                        },
                        {
                            label: 'เป้าหมาย',
                            data: targetValues,
                            borderColor: targetLineColor,
                            backgroundColor: 'rgba(0,0,0,0)',
                            fill: false,
                            tension: 0.3,
                            pointRadius: 0,
                            borderDash: [5, 5]
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                font: {
                                    family: 'Sarabun',
                                    color: '#000000'
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        label += context.parsed.y + unit;
                                    }
                                    return label;
                                }
                            },
                            titleFont: { family: 'Sarabun', size: 14 },
                            bodyFont: { family: 'Sarabun', size: 12 }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'เดือน',
                                font: { family: 'Sarabun', color: '#000000' }
                            },
                            ticks: {
                                font: { family: 'Sarabun', color: '#000000' }
                            }
                        },
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: `ค่า (${unit})`,
                                font: { family: 'Sarabun', color: '#000000' }
                            },
                            ticks: {
                                font: { family: 'Sarabun', color: '#000000' }
                            }
                        }
                    }
                }
            });
        };
        
        // ฟังก์ชันกำหนดสีตามประสิทธิภาพ
        const getPerformanceColor = (value, target, lowerIsBetter = false) => {
            if (lowerIsBetter) { // สำหรับ KPI ที่ค่าน้อยกว่าดีกว่า (เช่น ข้อผิดพลาด)
                if (value <= target * 0.75) return '#14b8a6'; // เขียว (ยอดเยี่ยม)
                if (value <= target) return '#0284c7'; // น้ำเงิน (ดี, อยู่ในเป้าหมาย)
                if (value <= target * 1.25) return '#f59e0b'; // ส้ม (สูงกว่าเป้าหมายเล็กน้อย)
                return '#f43f5e'; // แดง (สูงกว่าเป้าหมายมาก)
            } else { // สำหรับ KPI ที่ค่าสูงกว่าดีกว่า (เช่น เปอร์เซ็นต์)
                if (value >= target) return '#14b8a6'; // เขียว (บรรลุหรือเกินเป้าหมาย)
                if (value >= target * 0.9) return '#0284c7'; // น้ำเงิน (ใกล้เคียงเป้าหมาย)
                if (value >= target * 0.8) return '#f59e0b'; // ส้ม (ต่ำกว่าเป้าหมาย แต่ยังพอรับได้)
                return '#f43f5e'; // แดง (ต่ำกว่าเป้าหมายมาก)
            }
        };
        
        // ฟังก์ชันรับข้อความสถานะ
        const getStatusText = (value, target, lowerIsBetter = false) => {
            if (value === 'N/A' || target === 'N/A') return 'ไม่มีข้อมูล';
            if (lowerIsBetter) {
                 if (value <= target) return 'อยู่ในเกณฑ์เป้าหมาย';
                 return 'สูงกว่าเกณฑ์เป้าหมาย';
            } else {
                if (value >= target) return 'บรรลุเป้าหมาย';
                return 'ต่ำกว่าเป้าหมาย';
            }
        }

        // ฟังก์ชัน Populate month selector
        const populateMonthSelector = () => {
            monthSelect.innerHTML = '';
            // Ensure kpiData is available before proceeding
            if (!kpiData || kpiData.length === 0 || !kpiData[0].monthlyData) {
                console.warn("KPI data not available for month selector population.");
                return;
            }

            const months = Object.keys(kpiData[0].monthlyData).map(key => parseInt(key)).sort((a,b) => a-b);
            
            months.forEach(monthIndex => {
                const option = document.createElement('option');
                option.value = monthIndex;
                option.textContent = monthNames[monthIndex];
                monthSelect.appendChild(option);
            });

            // Set currentMonthIndex based on current date or last available data
            const today = new Date();
            const currentMonth = today.getMonth(); // 0-11
            if (kpiData[0].monthlyData[currentMonth]) {
                currentMonthIndex = currentMonth;
            } else {
                currentMonthIndex = months.length > 0 ? months[months.length - 1] : 0;
            }
            monthSelect.value = currentMonthIndex;
        };


        // ฟังก์ชัน Render การ์ด KPI
        const renderKpiCards = (monthIndex) => {
            grid.innerHTML = ''; // ล้างการ์ดที่มีอยู่
            // ทำลาย instance ของ Chart เก่าทั้งหมด
            for (const chartId in kpiCharts) {
                if (kpiCharts[chartId]) {
                    kpiCharts[chartId].destroy();
                    delete kpiCharts[chartId];
                }
            }

            kpiData.forEach(kpi => {
                const monthlyKpi = kpi.monthlyData[monthIndex];
                const prevMonthlyKpi = kpi.monthlyData[monthIndex - 1];

                const currentValue = monthlyKpi ? monthlyKpi.currentValue : 'N/A';
                const targetValue = monthlyKpi ? monthlyKpi.target : 'N/A';

                let changeIndicatorHtml = '';
                if (currentValue !== 'N/A' && prevMonthlyKpi && prevMonthlyKpi.currentValue !== 'N/A' && prevMonthlyKpi.currentValue !== 0) {
                    const change = currentValue - prevMonthlyKpi.currentValue;
                    const percentageChange = (change / prevMonthlyKpi.currentValue) * 100;
                    
                    let arrow = '—';
                    let changeColor = 'text-gray-500';

                    if (change > 0) {
                        arrow = '▲';
                        changeColor = kpi.lowerIsBetter ? 'text-rose-600' : 'text-emerald-600';
                    } else if (change < 0) {
                        arrow = '▼';
                        changeColor = kpi.lowerIsBetter ? 'text-emerald-600' : 'text-rose-600';
                    }

                    changeIndicatorHtml = `<span class="${changeColor} text-shadow-subtle">${Math.abs(percentageChange).toFixed(1)}% ${arrow}</span>`;
                }

                const card = document.createElement('div');
                card.className = 'bg-white bg-opacity-75 rounded-xl shadow-lg p-6 flex flex-col items-center text-center transition-transform duration-300 hover:scale-105';
                
                let vizHtml = '';
                if (kpi.type === 'percentage') {
                    if (currentValue !== 'N/A' && targetValue !== 'N/A') {
                        vizHtml = `<div class="chart-container"><canvas id="${kpi.id}"></canvas></div>`;
                    } else {
                        vizHtml = `<div class="h-[150px] flex flex-col justify-center items-center">
                                         <p class="kpi-value-lg font-bold text-gray-400 text-shadow-subtle">N/A</p>
                                         <p class="text-gray-900 text-lg text-shadow-subtle">${kpi.unit}</p>
                                         <p class="text-gray-900 text-shadow-subtle">เป้าหมาย: N/A ${kpi.unit}</p>
                                       </div>`;
                    }
                } else {
                    const colorClass = (currentValue !== 'N/A' && targetValue !== 'N/A') ? getPerformanceColor(currentValue, targetValue, kpi.lowerIsBetter) : 'text-gray-400';
                    vizHtml = `<div class="h-[150px] flex flex-col justify-center items-center">
                                 <p class="kpi-value-lg font-bold text-shadow-subtle" style="color: ${colorClass};">${currentValue}</p>
                                 <p class="text-gray-900 text-lg text-shadow-subtle">${kpi.unit}</p>
                                 <p class="text-gray-900 text-shadow-subtle">เป้าหมาย: ${kpi.lowerIsBetter ? '≤ ' : ''}${targetValue} ${kpi.unit}</p>
                               </div>`;
                }

                const sparklineCurrentValues = [];
                const sparklineTargetValues = [];
                for (let i = 0; i < 12; i++) { // ดึงข้อมูลทั้ง 12 เดือนสำหรับ sparkline
                    sparklineCurrentValues.push(kpi.monthlyData[i] ? kpi.monthlyData[i].currentValue : null);
                    sparklineTargetValues.push(kpi.monthlyData[i] ? kpi.monthlyData[i].target : null);
                }
                const sparklineColor = getPerformanceColor(currentValue, targetValue, kpi.lowerIsBetter);


                card.innerHTML = `
                    <h2 class="text-xl font-bold mb-2 text-black text-shadow-subtle">${kpi.title}</h2>
                    <div class="flex flex-col items-center justify-center mb-4">
                        <div class="flex items-center justify-center mb-1">
                            <p class="text-base text-gray-900 text-shadow-subtle">เดือนปัจจุบัน:</p>
                            <span class="text-gray-900 text-shadow-subtle ml-2">${currentValue} ${kpi.unit}</span>
                        </div>
                        ${changeIndicatorHtml ? `<p class="text-base text-gray-900 text-shadow-subtle">เดือนก่อนหน้า: ${changeIndicatorHtml}</p>` : `<p class="text-base text-gray-900 text-shadow-subtle">เดือนก่อนหน้า: ไม่มีข้อมูล</p>`}
                    </div>
                    ${vizHtml}
                    <div class="sparkline-container">
                        <canvas id="${kpi.id}-sparkline"></canvas>
                    </div>
                    <p class="mt-4 text-gray-900 text-shadow-subtle">${getStatusText(currentValue, targetValue, kpi.lowerIsBetter)}</p>
                    <div class="flex space-x-2 mt-6">
                        <button data-id="${kpi.id}" class="details-btn bg-blue-200 text-blue-800 font-semibold py-2 px-4 rounded-lg hover:bg-blue-300 transition-colors">
                            ดูรายละเอียด
                        </button>
                    </div>
                `;
                grid.appendChild(card);

                if (kpi.type === 'percentage' && currentValue !== 'N/A' && targetValue !== 'N/A') {
                    setTimeout(() => createGaugeChart(kpi.id, currentValue, targetValue, kpi.unit), 0);
                }
                setTimeout(() => createSparklineChart(kpi.id + '-sparkline', sparklineCurrentValues, sparklineTargetValues, kpi.unit, sparklineColor), 0);
            });

            // แนบ Event Listener สำหรับปุ่มดูรายละเอียด
            document.querySelectorAll('.details-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const kpiId = e.currentTarget.dataset.id;
                    const kpi = kpiData.find(k => k.id === kpiId);
                    const monthlyKpi = kpi.monthlyData[currentMonthIndex];

                    const chartLabels = [];
                    const chartCurrentValues = [];
                    const chartTargetValues = [];
                    for (let i = 0; i < 12; i++) {
                        const monthData = kpi.monthlyData[i.toString()];
                        chartLabels.push(monthNames[i]);
                        chartCurrentValues.push(monthData ? monthData.currentValue : null);
                        chartTargetValues.push(monthData ? monthData.target : null);
                    }
                    
                    modalTitle.textContent = kpi.title;
                    modalBody.innerHTML = `
                        <div class="space-y-3">
                            <div>
                                <p class="font-semibold text-gray-900 text-shadow-subtle">ดัชนีชี้วัด:</p>
                                <p class="text-shadow-subtle">${kpi.details.indicator}</p>
                            </div>
                            <div>
                                <p class="font-semibold text-gray-900 text-shadow-subtle">เป้าหมาย:</p>
                                <p class="text-lg font-bold ${kpi.lowerIsBetter ? 'text-blue-600' : 'text-emerald-600'} text-shadow-subtle">
                                    ${kpi.lowerIsBetter ? 'ไม่เกิน ' : ''}${monthlyKpi ? monthlyKpi.target : 'N/A'} ${kpi.unit}
                                </p>
                            </div>
                            <div>
                                <p class="font-semibold text-gray-900 text-shadow-subtle">ความถี่ในการประเมิน:</p>
                                <p class="text-shadow-subtle">${kpi.details.frequency}</p>
                            </div>
                             <div>
                                <p class="font-semibold text-gray-900 text-shadow-subtle">วิธีการประเมิน:</p>
                                <p class="text-sm text-shadow-subtle">${kpi.details.evaluation}</p>
                            </div>
                            <div>
                                <p class="font-semibold text-gray-900 text-shadow-subtle">เกณฑ์การให้คะแนน:</p>
                                <ul class="list-none space-y-1 mt-1">
                                    ${kpi.details.levels.map(l => `
                                        <li class="flex items-center justify-between p-2 rounded-md bg-gray-50">
                                            <span class="font-semibold ${l.color} text-shadow-subtle">ระดับ ${l.score}</span>
                                            <span class="text-shadow-subtle">${l.value}</span>
                                        </li>
                                    `).join('')}
                                </ul>
                            </div>
                            <div class="mt-6">
                                <h3 class="text-xl font-semibold mb-3 text-black text-shadow-subtle">แนวโน้มรายเดือน</h3>
                                <div class="chart-container-line">
                                    <canvas id="kpiLineChart"></canvas>
                                </div>
                            </div>
                        </div>
                    `;

                    modal.classList.remove('hidden');
                    setTimeout(() => {
                        modalContent.classList.remove('scale-95', 'opacity-0');
                        modalContent.classList.add('scale-100', 'opacity-100');
                        const kpiLineChartCanvas = document.getElementById('kpiLineChart');
                        if (kpiLineChartCanvas) {
                            createLineChart('kpiLineChart', chartLabels, chartCurrentValues, chartTargetValues, kpi.unit);
                        }
                    }, 10);
                });
            });
        };

        const closeModal = () => {
            modalContent.classList.remove('scale-100', 'opacity-100');
            modalContent.classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                modal.classList.add('hidden');
                if (lineChartInstance) {
                    lineChartInstance.destroy();
                    lineChartInstance = null;
                }
            }, 300);
        };

        modalCloseBtn.addEventListener('click', closeModal);
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                closeModal();
            }
        });

        const renderRiskOpportunityCards = () => {
            riskOpportunityGrid.innerHTML = '';
            riskOpportunityData.forEach(item => {
                const card = document.createElement('div');
                const typeColor = item.type === 'Risk' ? 'bg-rose-100' : 'bg-emerald-100';
                const textColor = item.type === 'Risk' ? 'text-rose-700' : 'text-emerald-700';
                const levelColor = item.level === 'สูง' ? 'text-rose-600' : (item.level === 'ปานกลาง' ? 'text-amber-600' : 'text-emerald-600');

                card.className = `bg-white bg-opacity-75 rounded-xl shadow-lg p-6 flex flex-col items-center text-center transition-transform duration-300 hover:scale-105 ${typeColor}`;
                card.innerHTML = `
                    <div class="text-lg font-bold mb-2 ${textColor} text-shadow-subtle">${item.type === 'Risk' ? 'ความเสี่ยง' : 'โอกาส'}</div>
                    <h3 class="text-xl font-bold mb-3 text-black text-shadow-subtle">${item.issue}</h3>
                    <p class="text-2xl font-bold ${levelColor} mb-4 text-shadow-subtle">ระดับ: ${item.level}</p>
                    <button data-id="${item.id}" class="ro-details-btn mt-4 bg-blue-500 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-600 transition-colors">
                        ดูรายละเอียด
                    </button>
                `;
                riskOpportunityGrid.appendChild(card);
            });

            document.querySelectorAll('.ro-details-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const itemId = e.currentTarget.dataset.id;
                    const item = riskOpportunityData.find(d => d.id === itemId);

                    roModalTitle.textContent = `${item.type === 'Risk' ? 'รายละเอียดความเสี่ยง' : 'รายละเอียดโอกาส'}: ${item.issue}`;
                    roModalBody.innerHTML = `
                        <div class="space-y-3">
                            <div>
                                <p class="font-semibold text-gray-900 text-shadow-subtle">ประเด็น:</p>
                                <p class="text-shadow-subtle">${item.issue}</p>
                            </div>
                            <div>
                                <p class="font-semibold text-gray-900 text-shadow-subtle">สาเหตุ:</p>
                                <p class="text-shadow-subtle">${item.cause}</p>
                            </div>
                            <div>
                                <p class="font-semibold text-gray-900 text-shadow-subtle">โอกาสที่จะเกิดขึ้น (ระดับ ${item.likelihood_score}):</p>
                                <p class="text-shadow-subtle">${item.likelihood_desc}</p>
                            </div>
                            <div>
                                <p class="font-semibold text-gray-900 text-shadow-subtle">ผลกระทบ (ระดับ ${item.impact_score}):</p>
                                <p class="text-shadow-subtle">${item.impact_desc}</p>
                            </div>
                            <div>
                                <p class="font-semibold text-gray-900 text-shadow-subtle">ระดับ ${item.type === 'Risk' ? 'ความเสี่ยง' : 'โอกาส'}:</p>
                                <p class="text-xl font-bold ${item.level === 'สูง' ? 'text-rose-600' : (item.level === 'ปานกลาง' ? 'text-amber-600' : 'text-emerald-600')} text-shadow-subtle">${item.level}</p>
                            </div>
                            <div>
                                <p class="font-semibold text-gray-900 text-shadow-subtle">มาตรการ:</p>
                                <p class="text-shadow-subtle">${item.mitigation}</p>
                            </div>
                        </div>
                    `;

                    roModal.classList.remove('hidden');
                    setTimeout(() => {
                        roModalContent.classList.remove('scale-95', 'opacity-0');
                        roModalContent.classList.add('scale-100', 'opacity-100');
                    }, 10);
                });
            });
        };

        const closeRoModal = () => {
            roModalContent.classList.remove('scale-100', 'opacity-100');
            roModalContent.classList.add('scale-95', 'opacity-0');
            setTimeout(() => roModal.classList.add('hidden'), 300);
        };

        roModalCloseBtn.addEventListener('click', closeRoModal);
        roModal.addEventListener('click', (e) => {
            if (e.target === roModal) {
                closeRoModal();
            }
        });

        const renderRiskOpportunitySummaryCharts = () => {
            const risksByLevel = { 'ต่ำ': [], 'ปานกลาง': [], 'สูง': [] };
            const opportunitiesByLevel = { 'ต่ำ': [], 'ปานกลาง': [], 'สูง': [] };

            riskOpportunityData.forEach(item => {
                if (item.type === 'Risk') {
                    risksByLevel[item.level].push(item.issue);
                } else if (item.type === 'Opportunity') {
                    opportunitiesByLevel[item.level].push(item.issue);
                }
            });

            const labels = ['ต่ำ', 'ปานกลาง', 'สูง'];

            // Render Risk Summary Chart
            const riskCounts = labels.map(level => risksByLevel[level].length);
            const ctxRisk = document.getElementById('riskSummaryChart').getContext('2d');
            if (riskSummaryChartInstance) {
                riskSummaryChartInstance.destroy();
            }
            riskSummaryChartInstance = new Chart(ctxRisk, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'ความเสี่ยง',
                            data: riskCounts,
                            backgroundColor: '#f43f5e', // Rose-500
                            borderColor: '#e11d48', // Rose-600 (darker border)
                            borderWidth: 1,
                            borderRadius: 8, // Rounded corners
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                font: {
                                    family: 'Sarabun',
                                    color: '#000000'
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                title: function(tooltipItems) {
                                    const item = tooltipItems[0];
                                    return item.dataset.label + " - " + item.label;
                                },
                                label: function(context) {
                                    return '';
                                },
                                afterBody: function(tooltipItems) {
                                    const item = tooltipItems[0];
                                    const level = item.label;
                                    const issues = risksByLevel[level];
                                    if (issues.length > 0) {
                                        return issues.map(issue => `- ${issue}`);
                                    }
                                    return [];
                                }
                            },
                            titleFont: { family: 'Sarabun', size: 16 },
                            bodyFont: { family: 'Sarabun', size: 14 }
                        },
                        datalabels: {
                            anchor: 'end',
                            align: 'end',
                            color: '#000000',
                            font: {
                                weight: 'bold',
                                family: 'Sarabun',
                                size: 12
                            },
                            formatter: function(value, context) {
                                return value > 0 ? value : '';
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'ระดับ',
                                font: { family: 'Sarabun', color: '#000000' }
                            },
                            grid: {
                                display: false
                            },
                            ticks: {
                                font: { family: 'Sarabun', color: '#000000' }
                            }
                        },
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'จำนวน',
                                font: { family: 'Sarabun', color: '#000000' }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)',
                                borderDash: [2, 2]
                            },
                            ticks: {
                                stepSize: 1,
                                font: { family: 'Sarabun', color: '#000000' }
                            }
                        }
                    }
                },
                plugins: [ChartDataLabels]
            });

            // Render Opportunity Summary Chart
            const opportunityCounts = labels.map(level => opportunitiesByLevel[level].length);
            const ctxOpportunity = document.getElementById('opportunitySummaryChart').getContext('2d');
            if (opportunitySummaryChartInstance) {
                opportunitySummaryChartInstance.destroy();
            }
            opportunitySummaryChartInstance = new Chart(ctxOpportunity, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'โอกาส',
                            data: opportunityCounts,
                            backgroundColor: '#10b981', // Emerald-500
                            borderColor: '#059669', // Emerald-600 (darker border)
                            borderWidth: 1,
                            borderRadius: 8, // Rounded corners
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                font: {
                                    family: 'Sarabun',
                                    color: '#000000'
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                title: function(tooltipItems) {
                                    const item = tooltipItems[0];
                                    return item.dataset.label + " - " + item.label;
                                },
                                label: function(context) {
                                    return '';
                                },
                                afterBody: function(tooltipItems) {
                                    const item = tooltipItems[0];
                                    const level = item.label;
                                    const issues = opportunitiesByLevel[level];
                                    if (issues.length > 0) {
                                        return issues.map(issue => `- ${issue}`);
                                    }
                                    return [];
                                }
                            },
                            titleFont: { family: 'Sarabun', size: 16 },
                            bodyFont: { family: 'Sarabun', size: 14 }
                        },
                        datalabels: {
                            anchor: 'end',
                            align: 'end',
                            color: '#000000',
                            font: {
                                weight: 'bold',
                                family: 'Sarabun',
                                size: 12
                            },
                            formatter: function(value, context) {
                                return value > 0 ? value : '';
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'ระดับ',
                                font: { family: 'Sarabun', color: '#000000' }
                            },
                            grid: {
                                display: false
                            },
                            ticks: {
                                font: { family: 'Sarabun', color: '#000000' }
                            }
                        },
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'จำนวน',
                                font: { family: 'Sarabun', color: '#000000' }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)',
                                borderDash: [2, 2]
                            },
                            ticks: {
                                stepSize: 1,
                                font: { family: 'Sarabun', color: '#000000' }
                            }
                        }
                    }
                },
                plugins: [ChartDataLabels]
            });
        };

        const renderCombinedTrendSummaryChart = () => {
            const container = document.getElementById('individual-trend-charts-container');
            container.innerHTML = ''; // Clear existing charts

            // Destroy all previous individual chart instances
            for (const chartId in individualTrendChartInstances) {
                if (individualTrendChartInstances[chartId]) {
                    individualTrendChartInstances[chartId].destroy();
                    delete individualTrendChartInstances[chartId];
                }
            }

            kpiData.forEach(kpi => {
                const chartLabels = [];
                const chartCurrentValues = [];
                const chartTargetValues = [];
                for (let i = 0; i < 12; i++) {
                    const monthData = kpi.monthlyData[i.toString()];
                    chartLabels.push(monthNames[i]);
                    chartCurrentValues.push(monthData ? monthData.currentValue : null);
                    chartTargetValues.push(monthData ? monthData.target : null);
                }

                // Create a div for each chart
                const chartWrapper = document.createElement('div');
                chartWrapper.className = 'bg-white bg-opacity-75 rounded-xl shadow-lg p-6';
                chartWrapper.innerHTML = `
                    <h3 class="text-2xl font-bold text-black mb-6 text-center text-shadow-subtle">${kpi.title} แนวโน้ม</h3>
                    <div class="chart-container-line h-[400px]">
                        <canvas id="trendChart-${kpi.id}"></canvas>
                    </div>
                `;
                container.appendChild(chartWrapper);

                // Create the chart
                setTimeout(() => {
                    createIndividualLineChart(
                        `trendChart-${kpi.id}`,
                        chartLabels,
                        chartCurrentValues,
                        chartTargetValues,
                        kpi.unit,
                        kpi.title,
                        kpi.lowerIsBetter // Pass lowerIsBetter to determine target line color
                    );
                }, 0);
            });
        };

        const openQuizPopup = (url) => {
            const width = 800;
            const height = 600;
            const left = (window.innerWidth / 2) - (width / 2);
            const top = (window.innerHeight / 2) - (height / 2);
            window.open(url, '_blank', `width=${width},height=${height},top=${top},left=${left},resizable=yes,scrollbars=yes`);
        };

        const activateNavButton = (buttonId) => {
            document.querySelectorAll('nav button').forEach(btn => {
                btn.classList.remove('bg-blue-300', 'text-blue-900');
                btn.classList.add('bg-blue-100', 'text-blue-700');
            });
            document.getElementById(buttonId).classList.remove('bg-blue-100', 'text-blue-700');
            document.getElementById(buttonId).classList.add('bg-blue-300', 'text-blue-900');
        };

        navKpiRiskBtn.addEventListener('click', () => {
            kpiRiskSection.classList.remove('section-hidden');
            combinedTrendSection.classList.add('section-hidden');
            quizSection.classList.add('section-hidden');
            documentFormsSection.classList.add('section-hidden');
            activateNavButton('nav-kpi-risk');
        });

        navCombinedTrendBtn.addEventListener('click', () => {
            kpiRiskSection.classList.add('section-hidden');
            combinedTrendSection.classList.remove('section-hidden');
            quizSection.classList.add('section-hidden');
            documentFormsSection.classList.add('section-hidden');
            activateNavButton('nav-combined-trend');
            renderCombinedTrendSummaryChart(); // เรียกใช้ฟังก์ชันเพื่อแสดงกราฟแยก
        });

        navQuizBtn.addEventListener('click', () => {
            kpiRiskSection.classList.add('section-hidden');
            combinedTrendSection.classList.add('section-hidden');
            quizSection.classList.remove('section-hidden');
            documentFormsSection.classList.add('section-hidden');
            activateNavButton('nav-quiz');
        });

        navDocumentFormsBtn.addEventListener('click', () => {
            kpiRiskSection.classList.add('section-hidden');
            combinedTrendSection.classList.add('section-hidden');
            quizSection.classList.add('section-hidden');
            documentFormsSection.classList.remove('section-hidden');
            activateNavButton('nav-document-forms');
        });

        document.addEventListener('DOMContentLoaded', () => {
            // Initial render of KPI cards and risk/opportunity section
            populateMonthSelector(); // Call this first to set up the dropdown and currentMonthIndex
            renderKpiCards(currentMonthIndex); // Then render cards based on the determined currentMonthIndex
            renderRiskOpportunityCards();
            renderRiskOpportunitySummaryCharts(); // Changed to plural to reflect two charts

            monthSelect.addEventListener('change', (e) => {
                currentMonthIndex = parseInt(e.target.value);
                renderKpiCards(currentMonthIndex);
            });

            document.querySelectorAll('.quiz-button').forEach(button => {
                button.addEventListener('click', (e) => {
                    const quizUrl = e.currentTarget.dataset.quizUrl;
                    openQuizPopup(quizUrl);
                });
            });
            activateNavButton('nav-kpi-risk');
        });
    </script>

</body>
</html>
